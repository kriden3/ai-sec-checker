# AI编程助手安全检测工具 — 详细模块拆分

## 1. 模块总览
本工具按下述核心模块划分，每个模块均可独立迭代与扩展。

- 1.1 工具环境风险检测模块
- 1.2 高危行为监控模块
- 1.3 外联与数据外发检测模块
- 1.4 敏感信息与配置加固建议模块
- 1.5 代码扫描与溯源模块
- 1.6 报告生成与日志管理模块
- 1.7 插件&适配扩展模块
- 1.8 通用CLI与主流程模块

---

## 1.1 工具环境风险检测模块

**功能目标：**  
自动发现本地的 AI 编程助手、辅助插件及相关配置，评估权限、敏感目录可达性及高危配置项，输出风险评分与修正建议。

**子功能列表：**
- AI工具/插件识别（进程/安装目录/配置文件）
- 权限检测（是否管理员/root，关键目录读写权限）
- 主流AI工具配置文件解析及风险项定位
- 环境安全评分与分级输出
- 支持新工具规则热插拔

**依赖技术：**  
psutil, os, glob, yaml/json, 自定义规则表

---

## 1.2 高危行为监控模块

**功能目标：**  
实时或离线监控 AI 工具进程的各种关键行为，并能及时告警/记录溯源。

**子功能列表：**
- 进程启动/退出监听
- 敏感文件操作监控（如 ~/.ssh ~/.aws 等目录的文件访问记录）
- 外部���令执行监控（拦截 shell/powershell 调用）
- 操作行为分类（读取/写入/删除）、高危模式识别
- 异常行为实时告警，生成溯源日志

**依赖技术：**  
watchdog, psutil, system call hook, 平台原生API（如Linux的inotify/Windows的WMI）

---

## 1.3 外联与数据外发检测模块

**功能目标：**  
检测AI工具相关进程的网络行为，发现异常IP/外联、流量模式和数据外发。

**子功能列表：**
- 网络端口与IP连接监听、映射到AI进程
- 流量实时统计与异常速率检测
- 对外目的地IP/域名归属地识别与威胁情报校验
- 外联行为风险分级、告警与审计记录

**依赖技术：**  
psutil, socket, netstat, 付费API（如IP情报）、日志归档模块

---

## 1.4 敏感信息与配置加固建议模块

**功能目标：**  
检测工具实际访问或发现的敏感文件内容，同时分析配置项安全状况，给出自适应修正建议。

**子功能列表：**
- 本地敏感资产扫描（API Key、token、私钥等）
- 配置项自动化分析与安全基准对比（JSON/YAML/INI/注册表等格式）
- 输出针对性修订建议（如“关闭外网支持”）
- 支持关键配置快捷 fix（如自动增/删配置字段）

**依赖技术：**  
re, configparser, pyyaml, 检测规则库

---

## 1.5 代码扫描与溯源模块

**功能目标：**  
对AI工具生成/修改的代码执行静态扫描、敏感信息检测和变更溯源。

**子功能列表：**
- 代码变更区块感知（与git diff等联动）
- 集成 Bandit/Semgrep/TruffleHog 等工具做多场景静态扫描
- 支持多语言规则扩展
- 结合行为监控日志回溯可疑生成片段

**依赖技术：**  
git, semgrep, bandit, trufflehog, difflib

---

## 1.6 报告生成与日志管理模块

**功能目标：**
将各检测结果合并，生成分级风险报告，日志管理便于后续审计和自动化集成。

**子功能列表：**
- 标准化风险报告多格式导出（终端彩色/Markdown/HTML/JSON）
- 审计日志本地归档与事件检索
- 支持定时“环境快照”与差异比较
- 报告可定制模版与扩展

**依赖技术：**  
jinja2, rich, logging

---

## 1.7 插件&适配扩展模块

**功能目标：**
保障工具长效生态和持续扩展，便于对新的AI工具、代码类型、检测规则等做快速适配。

**子功能列表：**
- 插件热插拔与沙箱隔离
- 适配主流AI工具的配置与识别规范
- 开放规则扩展接口（如：用户自定义检测规则/配置风险项）

**依赖技术：**  
importlib, yaml/json, 插件包格式约定

---

## 1.8 通用CLI与主流程模块

**功能目标：**
组织命令解析、主流程调度各检测模块，并给予用户友好的交互体验。

**子功能列表：**
- 命令行子命令与参数管理
- 配置文件加载与全局状态管理
- 扫描/监控进度与终端状态反馈
- 错误处理与指引友好化

**依赖技术：**  
argparse/click/typer, pyyaml, tqdm/rich

---

## 2. 模块之间的交互关系

- 工具环境检测、行为监控、网络监控共同向报告模块汇报检测与风险数据
- 配置建议和敏感信息检测结果也归档于报告
- 插件扩展模块需为上述各功能模块暴露接口以便后续拓展
- CLI统一调度主干流程，支持单项/联合多项检测

---

## 3. 典型执行流程举例  
1. 用户执行 `ai-sec-checker check-env-risk`  
    - CLI模块调用环境检测、配置扫描模块  
    - 结果交付报告模块渲染为终端和md报告

2. 用户执行 `ai-sec-checker monitor-ai-behavior --duration 600`  
    - 调用行为监控和外联检测模块，收集日志  
    - 实时有高危行为推送终端提示，任务完成后导出事件报告

---

如需对具体子模块再做功能和技术细节拆分，欢迎进一步细化需求。
